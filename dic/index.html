<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>사전 검색 서비스</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- 검색창 -->
    <div id="search-box">
        <input id="search" type="text" value="">
        <input id="submit" type="submit" value="submit">
    </div>

    <!-- 사전 -->
    <div id="container"></div>
    <script>
        const query = document.getElementById('search')
        const submitBtn = document.getElementById('submit')
        /*const BASE_URL = 'http://localhost:5000/api/words'*/
        const BASE_URL = 'https://dictionary-search2.herokuapp.com/api/words'

        //서버 데이터 가져오기
        function getData(baseUrl, query) {
            //fetch`${접속할 url, }`
            fetch(`${baseUrl}/${query}`, {
                headers: {
                    "Content-Type": "application/json"
                }
            })
                .then(res => res.json())
                .then(data => {
                    console.log(data)
                    const { words } = data;
                    const template = words.map(word => {
                        return (
                            `
                                <div class="item">
                                        <div class="word">
                                            <pre><a href = "${word.r_link}" target="_blank">${word.r_word}</a><sup>${word.r_seq ? word.r_seq : ""}</sup><a class="r_chi">${word.r_chi}</a><a class = "r_pos">${word.r_pos}</a></pre>
                                        </div>                        
                                        <p class="r_des">${word.r_des}</p>
                                        <hr>
                                </div>
                            `
                        )
                    })
                    container.innerHTML = template.join("") // DOM에 Template 삽입
                })
        }

        submitBtn.addEventListener('click', function () {
            console.log(query.value)
            getData(BASE_URL, query.value)
        })
        // 검색하고 마우스로 submit안누르고 엔터눌러도 되게하는 function
        query.addEventListener('keypress', function (e) {
            console.log("Key Pressed")
            if (e.keyCode === 13) {
                getData(BASE_URL, query.value)
            }
        })
        window.addEventListener('DOMContentLoaded', function () {
            getData(BASE_URL)
        })
    </script>
</body>

</html>